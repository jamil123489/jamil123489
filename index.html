<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="stylesheet" href="css/Le.css">
  <link rel="stylesheet" href="css/L.Control.Locate.min.css">
  <link rel="stylesheet" href="css/GISMapJamil.css">
  <link rel="stylesheet" href="css/fontawesome-all.min.css">
  <link rel="stylesheet" href="css/search.css">
  <link rel="stylesheet" href="css/filter.css">
  <link rel="stylesheet" href="css/nouislider.min.css">
  <style>
    html,
    body,
    #map {
      width: 100%;
      height: 100%;
      padding: 0;
      margin: 0;
    }
  </style>
  <title>find address and PostCode</title>
</head>

<body>
  <div id="map">
  </div>
  <script src="js/GISJamiMAP_expressions.js"></script>
  <script src="js/le.js"></script>
  <script src="js/L.Control.Locate.min.js"></script>
  <script src="js/le.rotatedMarker.js.js"></script>
  <script src="js/le.pattern.js"></script>
  <script src="js/le-hash.js"></script>
  <script src="js/Autolinker.min.js"></script>
  <script src="js/rbush.min.js"></script>
  <script src="js/labelgun.min.js"></script>
  <script src="js/labels.js"></script>
  <script src="js/search.js"></script>
  <script src="js/tailDT.js"></script>
  <script src="js/nouislider.min.js"></script>
  <script src="js/wNumb.js"></script>
  <script src="data/street_0.js"></script>
  <script src="data/District_1th_3.js"></script>
  <script>
    var map = L.map('map').setView([34.5553, 69.2075], 13);
    var hash = new L.Hash(map);
    map.attributionControl.setPrefix('<a href="https://afghanpost.gov.af" target="_blank">abdul jamil gis expert</a> &middot;');
    var autolinker = new Autolinker({ truncate: { length: 30, location: 'smart' } });
    L.control.locate({ locateOptions: { maxZoom: 19 } }).addTo(map);
    var bounds_group = new L.featureGroup([]);
    function setBounds() {
    }
    function pop_street_0(feature, layer) {
      var popupContent = '<table>\
                    <tr>\
                        <td colspan="2"><strong>ADDRESS</strong><br />' + (feature.properties['ADDRESS'] !== null ? autolinker.link(feature.properties['ADDRESS'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
      layer.bindPopup(popupContent, { maxHeight: 400 });
    }

    function style_street_0_0() {
      return {
        pane: 'pane_street_0',
        opacity: 0.5,
        color: 'rgba(133,182,111,1.0)',
        dashArray: '',
        lineCap: 'square',
        lineJoin: 'bevel',
        weight: 1.0,
        fillOpacity: 0,
        interactive: true,
      }
    }
    map.createPane('pane_street_0');
    map.getPane('pane_street_0').style.zIndex = 400;
    map.getPane('pane_street_0').style['mix-blend-mode'] = 'normal';
    var layer_street_0 = new L.geoJson(json_street_0, {
      attribution: '',
      interactive: true,
      dataVar: 'json_street_0',
      layerName: 'layer_street_0',
      pane: 'pane_street_0',
      onEachFeature: pop_street_0,
      style: style_street_0_0,
    });
    bounds_group.addLayer(layer_street_0);
    map.addLayer(layer_street_0);
    map.createPane('pane_EsriTopographic_1');
    map.getPane('pane_EsriTopographic_1').style.zIndex = 401;
    var layer_EsriTopographic_1 = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      pane: 'pane_EsriTopographic_1',
      opacity: 1.0,
      attribution: '',
      minZoom: 1,
      maxZoom: 28,
    });
    layer_EsriTopographic_1;
    map.addLayer(layer_EsriTopographic_1);
    map.createPane('pane_GoogleSatellite_2');
    map.getPane('pane_GoogleSatellite_2').style.zIndex = 402;
    var layer_GoogleSatellite_2 = L.tileLayer('https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
      pane: 'pane_GoogleSatellite_2',
      opacity: 1.0,
      attribution: '',
      minZoom: 1,
      maxZoom: 28,
    });
    layer_GoogleSatellite_2;
    map.addLayer(layer_GoogleSatellite_2);
    function pop_District_1th_3(feature, layer) {
      var popupContent = '<table>\
                    <tr>\
                        <th scope="row">District</th>\
                        <td>' + (feature.properties['District'] !== null ? autolinker.link(feature.properties['District'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">City_name</th>\
                        <td>' + (feature.properties['City_name'] !== null ? autolinker.link(feature.properties['City_name'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Province</th>\
                        <td>' + (feature.properties['Province'] !== null ? autolinker.link(feature.properties['Province'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Country</th>\
                        <td>' + (feature.properties['Country'] !== null ? autolinker.link(feature.properties['Country'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">PostCode</th>\
                        <td>' + (feature.properties['PostCode'] !== null ? autolinker.link(feature.properties['PostCode'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">area</th>\
                        <td>' + (feature.properties['area'] !== null ? autolinker.link(feature.properties['area'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
      layer.bindPopup(popupContent, { maxHeight: 400 });
    }

    function style_District_1th_3_0() {
      return {
        pane: 'pane_District_1th_3',
        opacity: 1,
        color: 'rgba(228,26,28,1.0)',
        dashArray: '',
        lineCap: 'square',
        lineJoin: 'bevel',
        weight: 4.0,
        fillOpacity: 0,
        interactive: true,
      }
    }
    map.createPane('pane_District_1th_3');
    map.getPane('pane_District_1th_3').style.zIndex = 403;
    map.getPane('pane_District_1th_3').style['mix-blend-mode'] = 'normal';
    var layer_District_1th_3 = new L.geoJson(json_District_1th_3, {
      attribution: '',
      interactive: true,
      dataVar: 'json_District_1th_3',
      layerName: 'layer_District_1th_3',
      pane: 'pane_District_1th_3',
      onEachFeature: pop_District_1th_3,
      style: style_District_1th_3_0,
    });
    bounds_group.addLayer(layer_District_1th_3);
    map.addLayer(layer_District_1th_3);
    var baseLayers = {

      "ماهواره": layer_GoogleSatellite_2,
      " نقشه": layer_EsriTopographic_1,
    };

    L.control.layers(baseLayers).addTo(map);
    //var baseMaps = {};
    //L.control.layers(baseMaps,{"ماهواره": layer_GoogleSatellite_2," نقشه": layer_EsriTopographic_1,}).addTo(map);
    //مقیاس
    L.control.scale().addTo(map);


    map.on("zoomend", function () {

      if (map.hasLayer(layer_District_1th_3)) {
        if (map.getZoom() <= 14 && map.getZoom() >= 17) {
          layer_District_1th_3.eachLayer(function (layer) {
            layer.openTooltip();
          });
        } else {
          layer_District_1th_3.eachLayer(function (layer) {
            layer.closeTooltip();
          });
        }
      }
    });
    setBounds();
    var i = 0;
    layer_District_1th_3.eachLayer(function (layer) {
      var context = {
        feature: layer.feature,
        variables: {}
      };
      layer.bindTooltip((layer.feature.properties['PostCode'] !== null ? String('<div style="color: #e31a1c; font-size: 16pt; font-style: italic; font-family: \'Cambria\', sans-serif;">' + layer.feature.properties['PostCode']) + '</div>' : ''), { permanent: true, offset: [-0, -16], className: 'css_District_1th_3' });
      labels.push(layer);
      totalMarkers += 1;
      layer.added = true;
      addLabel(layer, i);
      i++;
    });
    if (map.hasLayer(layer_District_1th_3)) {
      if (map.getZoom() <= 14 && map.getZoom() >= 17) {
        layer_District_1th_3.eachLayer(function (layer) {
          layer.openTooltip();
        });
      } else {
        layer_District_1th_3.eachLayer(function (layer) {
          layer.closeTooltip();
        });
      }
    }
    map.addControl(new L.Control.Search({
      layer: layer_street_0,
      initial: false,
      hideMarkerOnCollapse: true,
      propertyName: 'ADDRESS'
    }));
    document.getElementsByClassName('search-button')[0].className +=
      ' fa fa-binoculars';
    var mapDiv = document.getElementById('map');
    var row = document.createElement('div');
    row.className = "row";
    row.id = "all";
    row.style.height = "100%";
    var col1 = document.createElement('div');
    col1.className = "col9";
    col1.id = "mapWindow";
    col1.style.height = "99%";
    col1.style.width = "80%";
    col1.style.display = "inline-block";
    var col2 = document.createElement('div');
    col2.className = "col3";
    col2.id = "menu";
    col2.style.display = "inline-block";
    mapDiv.parentNode.insertBefore(row, mapDiv);
    document.getElementById("all").appendChild(col1);
    document.getElementById("all").appendChild(col2);
    col1.appendChild(mapDiv)
    var Filters = { "Province": "str", "PostCode": "str" };
    function filterFunc() {
      map.eachLayer(function (lyr) {
        if ("options" in lyr && "dataVar" in lyr["options"]) {
          features = this[lyr["options"]["dataVar"]].features.slice(0);
          try {
            for (key in Filters) {
              keyS = key.replace(/[^a-zA-Z0-9_]/g, "")
              if (Filters[key] == "str" || Filters[key] == "bool") {
                var selection = [];
                var options = document.getElementById("sel_" + keyS).options
                for (var i = 0; i < options.length; i++) {
                  if (options[i].selected) selection.push(options[i].value);
                }
                try {
                  if (key in features[0].properties) {
                    for (i = features.length - 1;
                      i >= 0; --i) {
                      if (selection.indexOf(
                        features[i].properties[key]) < 0
                        && selection.length > 0) {
                        features.splice(i, 1);
                      }
                    }
                  }
                } catch (err) {
                }
              }
              if (Filters[key] == "int") {
                sliderVals = document.getElementById(
                  "div_" + keyS).noUiSlider.get();
                try {
                  if (key in features[0].properties) {
                    for (i = features.length - 1; i >= 0; --i) {
                      if (parseInt(features[i].properties[key])
                        < sliderVals[0]
                        || parseInt(features[i].properties[key])
                        > sliderVals[1]) {
                        features.splice(i, 1);
                      }
                    }
                  }
                } catch (err) {
                }
              }
              if (Filters[key] == "real") {
                sliderVals = document.getElementById(
                  "div_" + keyS).noUiSlider.get();
                try {
                  if (key in features[0].properties) {
                    for (i = features.length - 1; i >= 0; --i) {
                      if (features[i].properties[key]
                        < sliderVals[0]
                        || features[i].properties[key]
                        > sliderVals[1]) {
                        features.splice(i, 1);
                      }
                    }
                  }
                } catch (err) {
                }
              }
              if (Filters[key] == "date"
                || Filters[key] == "datetime"
                || Filters[key] == "time") {
                try {
                  if (key in features[0].properties) {
                    HTMLkey = key.replace(/[&\/\\#,+()$~%.'":*?<>{} ]/g, '');
                    startdate = document.getElementById("dat_" +
                      HTMLkey + "_date1").value.replace(" ", "T");
                    enddate = document.getElementById("dat_" +
                      HTMLkey + "_date2").value.replace(" ", "T");
                    for (i = features.length - 1; i >= 0; --i) {
                      if (features[i].properties[key] < startdate
                        || features[i].properties[key] > enddate) {
                        features.splice(i, 1);
                      }
                    }
                  }
                } catch (err) {
                }
              }
            }
          } catch (err) {
          }
          this[lyr["options"]["layerName"]].clearLayers();
          this[lyr["options"]["layerName"]].addData(features);
          var i = 0;
          layer_District_1th_3.eachLayer(function (layer) {
            var context = {
              feature: layer.feature,
              variables: {}
            };
            layer.bindTooltip((layer.feature.properties['PostCode'] !== null ? String('<div style="color: #e31a1c; font-size: 16pt; font-style: italic; font-family: \'Cambria\', sans-serif;">' + layer.feature.properties['PostCode']) + '</div>' : ''), { permanent: true, offset: [-0, -16], className: 'css_District_1th_3' });
            labels.push(layer);
            totalMarkers += 1;
            layer.added = true;
            addLabel(layer, i);
            i++;
          });
        }
      })
    }
    document.getElementById("menu").appendChild(
      document.createElement("div"));
    var div_Province = document.createElement('div');
    div_Province.id = "div_Province";
    div_Province.className = "filterselect";
    document.getElementById("menu").appendChild(div_Province);
    sel_Province = document.createElement('select');
    sel_Province.multiple = true;
    sel_Province.size = 1;
    sel_Province.id = "sel_Province";
    var Province_options_str = "<option value='' unselected></option>";
    sel_Province.onchange = function () { filterFunc() };
    Province_options_str += '<option value="Kabul">Kabul</option>';
    sel_Province.innerHTML = Province_options_str;
    div_Province.appendChild(sel_Province);
    var lab_Province = document.createElement('div');
    lab_Province.innerHTML = 'Province';
    lab_Province.className = 'filterlabel';
    div_Province.appendChild(lab_Province);
    var reset_Province = document.createElement('div');
    reset_Province.innerHTML = 'clear filter';
    reset_Province.className = 'filterlabel';
    reset_Province.onclick = function () {
      var options = document.getElementById("sel_Province").options;
      for (var i = 0; i < options.length; i++) {
        options[i].selected = false;
      }
      filterFunc();
    };
    div_Province.appendChild(reset_Province);
    document.getElementById("menu").appendChild(
      document.createElement("div"));
    var div_PostCode = document.createElement('div');
    div_PostCode.id = "div_PostCode";
    div_PostCode.className = "filterselect";
    document.getElementById("menu").appendChild(div_PostCode);
    sel_PostCode = document.createElement('select');
    sel_PostCode.multiple = true;
    sel_PostCode.size = 7;
    sel_PostCode.id = "sel_PostCode";
    var PostCode_options_str = "<option value='' unselected></option>";
    sel_PostCode.onchange = function () { filterFunc() };
    PostCode_options_str += '<option value="100101">100101</option>';
    PostCode_options_str += '<option value="100102">100102</option>';
    PostCode_options_str += '<option value="100103">100103</option>';
    PostCode_options_str += '<option value="100104">100104</option>';
    PostCode_options_str += '<option value="100105">100105</option>';
    PostCode_options_str += '<option value="100106">100106</option>';
    PostCode_options_str += '<option value="100107">100107</option>';
    sel_PostCode.innerHTML = PostCode_options_str;
    div_PostCode.appendChild(sel_PostCode);
    var lab_PostCode = document.createElement('div');
    lab_PostCode.innerHTML = 'PostCode';
    lab_PostCode.className = 'filterlabel';
    div_PostCode.appendChild(lab_PostCode);
    var reset_PostCode = document.createElement('div');
    reset_PostCode.innerHTML = 'clear filter';
    reset_PostCode.className = 'filterlabel';
    reset_PostCode.onclick = function () {
      var options = document.getElementById("sel_PostCode").options;
      for (var i = 0; i < options.length; i++) {
        options[i].selected = false;
      }
      filterFunc();
    };
    div_PostCode.appendChild(reset_PostCode);
    resetLabels([layer_District_1th_3]);
    map.on("zoomend", function () {
      resetLabels([layer_District_1th_3]);
    });
    map.on("layeradd", function () {
      resetLabels([layer_District_1th_3]);
    });
    map.on("layerremove", function () {
      resetLabels([layer_District_1th_3]);
    });
  </script>
  <p style="left: 0;right: 0;top: 0;bottom: 0;">jamil samim GIS expert</p>
</body>

</html>